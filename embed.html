<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<!--
    Copyright 2012 Brad Christie

    This file is part of TAMinations.

    TAMinations is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    TAMinations is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with TAMinations.  If not, see <http://www.gnu.org/licenses/>.
-->
<head>


<meta name="viewport" content="width=device-width" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link type="image/x-icon" href="../favicon.ico" rel="icon" />
<link href="src/tamination.css" type="text/css" rel="stylesheet" />
<link href="src/jquery-ui.css" rel="stylesheet" />
<script src="ext/cookie.js" type="text/javascript"></script>
<script src="ext/jquery/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="ext/jquery/jquery.svg/jquery.svg.js" type="text/javascript"></script>
<script src="ext/jquery/jquery.ui/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js" type="text/javascript"></script>
<script src="ext/jquery/jquery.mousewheel/jquery-mousewheel-3.1.6/jquery.mousewheel.js" type="text/javascript"></script>
<script src="src/tamination.js" type="text/javascript"></script>
<script src="src/tamsvg.js" type="text/javascript"></script>


<script type="text/javascript">

  function dims() {
    var w = window.innerWidth;
    if (!w)
      w = document.body.scrollWidth;
    var h = window.innerHeight;
    if (!h)
      h = document.body.clientHeight;
    if (!h)
      h = w + 100;
    return {
      w : w,
      h : h
    };
  }

  function buildAnimation(tam) {
    tam.selectByCall(call);
    var d = dims();
    var svgstr = '<div id="svgcontainer"><div id="svgdiv" ' + 'style="width:'
        + d.w + 'px; height:' + (d.h - 120)
        + 'px; background-color:#ffffc0"></div></div>';
    $("body").prepend(svgstr);
    $('#svgdiv').svg({
      onLoad : TamSVG
    });
    generateButtonPanel();
    if (args.play)
      tamsvg.start();
  }

  var search = document.URL.split(/\?/)[1];
  args = search.split(/&/);
  var page = args[0].split(/\./)[0];
  var call = args[0].split(/\./)[1];
  if (call == null) {
    page = args[0];
    call = '';
  }
  page += '.xml';
  var params = {};
  for (var i = 1; i < args.length; i++) {
    params[args[i]] = 1;
  }
  args = params;

  var callnumber = 0;
  var currentcall = 'No Call';

  $(document).ready(function() {
    var d = dims();
    $('#tamdiv').width(d.w);
    $('#tamdiv').height(d.h);
    new TAMination(page, buildAnimation, function() {
      //  Try alternatives for ms and adv pages
      //  One of these is sure to fail, but that's ok
      if (page.match(/^ms/)) {
        loadXML(page.replace('ms', 'b1'));
        loadXML(page.replace('ms', 'b2'));
      }
      if (page.match(/^adv/)) {
        loadXML(page.replace('adv', 'a1'));
        loadXML(page.replace('adv', 'a2'));
      }
    });
  });

  </script>
</head>
<body>
<div id="tamdiv"></div>
</body>
</html>
